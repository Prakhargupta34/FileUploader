# Overview
Our application processes backend request (such as uploading file, 
download file, creating shared public URL of file etc) and allows client 
to stores files in any one of the following cloud providers, either AWS 
or Azure.

Cloud Storage type, credentials and other configuration needs to 
provided while onboarding the clients, so that we can access their 
cloud storage.

Secrets will be stored at our end. We are using Azure Key Vault for 
storing secrets and it is independent of the cloud provider used by 
the client.
Steps required to run the application

## A) Setting up the database
1. Microsoft SQL server is being used, so you need to create a database in Microsoft 
SQL server.
2. We have used the docker image of MS Sql Server to run the database via this 
command: docker run -e "ACCEPT_EULA=Y" -e "SA_PASSWORD=zaq1@123" -p 
1433:1433 -d mcr.microsoft.com/mssql/server:2017-latest. 
You also need to create the database inside this SQL Server
3. SqlServerConnectionString needs to be added in AppSetting.json file as shown in 
the image below. For example,
"SqlServerConnectionString": "Server=localhost,1433;Database=FileUploader;User
Id=sa;Password=zaq1@123;TrustServerCertificate=True;"
4. Your database will be automatically migrated (table schema gets created) when 
application runs.

## B) Setting up the Azure Key Vault for storing secrets
1. Key Vault needs to be created in Azure and for accessing the key vault from 
application service principal needs to be created. You need to copy Key Vault URL as 
shown in below image and add it to Appsetting.json file at AzureKeyVault:Url.
2. You need to follow this document to create the service principal 
https://docs.microsoft.com/en-us/azure/purview/create-service-principal-azure .
3. You need to copy ClientID and tenantID as shown in below image and add it to the 
Appsetting.json file at AzureKeyVault:ClientId and AzureKeyVault:TenantId.
4. You need to create client credentials for the above create service principal. Then 
client secrets value needs to be copied as shown below and add it to the 
Appsetting.json file at AzureKeyVault:Secret
5. You need to attach the above created service principal to the key vault by adding access 
policy to the keyvault. You can follow this document for that. 
https://docs.microsoft.com/en-us/azure/key-vault/general/assign-access-policy?tabs=azureportal

## API Endpoints

### 1. Client
#### POST - /api/client
This end point is responsible for onboarding the client which accepts it’s
cloud provider details and admin user details to be created.
#### Request
```
{
"name": "string",
"cloudProviderType": "string",
"awsCloudProvider": {
 "bucketName": "string",
 "region": "string",
 "secretAccessKey": "string",
 "accessKeyId": "string"
},
"azureCloudProvider": {
 "storageAccountConnectionString": "string",
 "storageContainerName": "string"
},
"adminUser": {
 "username": "string",
 "password": "string",
 "emailAddress": "string",
 "role": "string"
}
}
```
“name” is clientName.

“cloudProviderType” is one of 'aws' or 'azure'.
If cloudProviderType is aws, then awsCloudProvider needs to be provided in the 
request. Else azureCloudProvider needs to be provided in the request.

### 2. Login
#### POST - /api/login
This end point is responsible for logging in the user and generating jwt 
token which needs to be passed for accessing authorised end points 
such as upload, download etc.
#### Request
```
{
"userName": "string",
"password": "string
}
```

### 3. User
#### POST - /api/user
This end point is responsible for creating the users. This is the authorized 
end point and can only be accessed by jwt token generated by logging in 
admin users.
This will create the user and attached it to the same clientID as of the 
admin user.
#### Request
```
{
"userName": "string",
"password": "string,
"emailAddress": "string",
"role": "string
}
```
"role" present in request can either be 'Administrator' or 'User'.

### 4. Files
#### A) POST - /api/files/upload
This end point is responsible for uploading the file. This is the authorized 
end point and can only be accessed by jwt token passed in headers.
Request
File will be passed as multipart/form data. If opening in swagger, you can easily 
choose the file.
#### B) GET - /api/?fileName={filename}
This end point is responsible for downloading the file. This is the 
authorized end point and can only be accessed by jwt token passed in 
headers.
#### C) GET - /api/files/getshareableurl/?filleName={filename}&expiryInMins={expiryInMinutes}
This end point is responsible for creating the public shareable url of the 
file which can be accessed by anyone having the url and the url will 
expired after specified time mentioned (expiryInMinutes) while calling 
the api. This is the authorized end point and can only be accessed by jwt 
token passed in headers.
